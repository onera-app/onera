# =============================================================================
# Onera - Azure Container Apps Deployment Configuration
# =============================================================================
# This file is used for building and pushing images to Azure Container Registry
# Usage:
#   1. Set ACR_NAME environment variable to your registry name
#   2. Run: docker compose -f docker-compose.azure.yml build
#   3. Run: docker compose -f docker-compose.azure.yml push
# =============================================================================

services:
  server:
    image: ${ACR_NAME:-yourregistry}.azurecr.io/onera-server:${TAG:-latest}
    build:
      context: .
      dockerfile: apps/server/Dockerfile
      platforms:
        - linux/amd64
    environment:
      - DATABASE_URL
      - BETTER_AUTH_SECRET
      - BETTER_AUTH_URL
      - FRONTEND_URL
      - NODE_ENV=production

  web:
    image: ${ACR_NAME:-yourregistry}.azurecr.io/onera-web:${TAG:-latest}
    build:
      context: .
      dockerfile: apps/web/Dockerfile
      platforms:
        - linux/amd64
      args:
        VITE_API_URL: ${VITE_API_URL:-https://api.yourapp.com}
        VITE_WS_URL: ${VITE_WS_URL:-https://api.yourapp.com}
